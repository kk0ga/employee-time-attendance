# 月次サマリ（平日/休日）仕様

## 目的
- ダッシュボードの「今月サマリ」で、平日稼働と休日稼働を分けて把握できるようにする。
- 休日稼働は勤怠の実績として計上しつつ、平日と区別して表示する。

## 用語と区分
- **平日**: 土日祝を除く日（曜日が月〜金（1〜5）かつ、祝日ではない日）。
- **休日**: 土日または祝日。
- **祝日判定**: Google Calendar（祝日カレンダー）から当月分をオンデマンド取得して判定する。
  - 取得に失敗した場合は画面に警告を表示し、祝日判定なし（土日判定のみ）で表示する。

## 対象データ
- データソース: SharePoint Online List（Attendance）
- 対象列:
  - AttendanceDate（YYYY-MM-DD, Tokyo）
  - StartTime（HH:mm, 任意）
  - EndTime（HH:mm, 任意）
- タイムゾーン: Asia/Tokyo

## 集計ルール
- 月内の全日付（1日〜最終日）を対象に集計する。
- 平日/休日の判定は `weekday`（0=Sun, 6=Sat）と祝日判定の組み合わせで行う。
- 出勤日数:
  - StartTime が存在する日を「出勤日」とみなす。
  - 平日出勤: 平日の出勤日数 / 平日総日数（※土日祝除外）
  - 休日出勤: 休日の出勤日数 / 休日総日数（※土日祝）
- 労働時間:
  - StartTime と EndTime が両方ある場合のみ算出する。
  - 算出式: `max(0, EndTime - StartTime)`
  - 平日労働時間 / 休日労働時間 を分けて合計する。
- 合計:
  - 実出勤日合計 = 平日出勤日数 + 休日出勤日数
  - 総労働時間 = 平日労働時間 + 休日労働時間

## UI 表示（ダッシュボード）
- 出勤日（平日）: 平日出勤日数 / 平日総日数
- 出勤日（休日）: 休日出勤日数 / 休日総日数
- 労働時間（平日）
- 労働時間（休日）
- 実出勤日合計
- 総労働時間

## 仕様上の留意点
- 休日（祝日/会社休日）を正確に扱うには会社カレンダーが必要。
  - 低トラフィック・低コスト前提のため、まずは土日判定のみで運用する。
- 休日稼働の扱いは「平日と同等に集計しない」前提とする。
  - 平日出勤と休日出勤を必ず分けて表示し、誤解を避ける。

## 将来拡張（任意）
- 会社カレンダー（休日/稼働日）を SharePoint List で管理し、平日/休日の判定に反映する。
- 祝日 API を導入する場合は、外部API連携の可否と運用コストを再検討する。
